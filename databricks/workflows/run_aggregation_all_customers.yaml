resources:
  jobs:
    Run_Aggregation_All_Customers:
      name: Run_Aggregation_All_Customers
      email_notifications:
        on_success:
          - eran@seemplicity.io
        on_failure:
          - eran@seemplicity.io
      timeout_seconds: 14400
      tasks:
        - task_key: loop_over_customers
          for_each_task:
            inputs: '[{"customer_schema":"carlsberg","postgres_host":"vpce-0ab78c002b187f211-1l5gyxsr.vpce-svc-0ec8249541aa206d0.eu-central-1.vpce.amazonaws.com","postgres_port":54323,"postgres_db":"postgres","postgres_user":"postgres","postgres_password":"<password>"},{"customer_schema":"unilever","postgres_host":"vpce-0ab78c002b187f211-1l5gyxsr.vpce-svc-0ec8249541aa206d0.eu-central-1.vpce.amazonaws.com","postgres_port":54322,"postgres_db":"postgres","postgres_user":"postgres","postgres_password":"<password>"}]'
            concurrency: 10
            task:
              task_key: run_aggregation_single_customer
              notebook_task:
                notebook_path: /Workspace/Users/eran@seemplicity.io/dbx_notebook_parameterized
                base_parameters:
                  input: "{{input}}"
                source: WORKSPACE
              existing_cluster_id: 0821-114322-oey3d1jg
      queue:
        enabled: true
