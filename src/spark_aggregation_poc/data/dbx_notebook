import sys
import os

# Add the src directory to Python path
sys.path.append("/Workspace/Users/eran@seemplicity.io/spark-aggregation-poc/src")

from spark_aggregation_poc.config.config import Config
from spark_aggregation_poc.main import run_aggregation_from_dbx

config: Config = Config(postgres_url="jdbc:postgresql://<host>>:54323/postgres?currentSchema=aroundtown",
                        postgres_properties={
                            "user": "<user>",
                            "password": "<password>",
                            "driver": "org.postgresql.Driver"
                        },
                        is_databricks = True
                    )
# Cell 1: Monitor cluster configuration
print("=== Cluster Configuration ===")
print(f"Executor memory: {spark.conf.get('spark.executor.memory')}")
print(f"Default parallelism: {spark.sparkContext.defaultParallelism}")

run_aggregation_from_dbx(spark, config=config)